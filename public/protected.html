<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Ruta protegida</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>

</head>

<body>

    <h1>Ruta protegida</h1>
    <div>
        <h2 id="app">Email: </h2>
        <button id="logout">Cerrar sesi√≥n</button>

    </div>

    <script>

        const logout = document.getElementById("logout")
        logout.addEventListener("click", async () => {
            const res = await fetch("/api/v1/logout", {
                method: "GET",
                // headers: {
                //     "Content-Type": "application/json",
                //     Authorization: "Bearer " + token,
                // },
                // credentials: "include",
            });
            console.log(res);
        });

        document.addEventListener("DOMContentLoaded", async (e) => {
            try {

                const resToken = await fetch("/api/v1/refresh", {
                    method: "GET",
                    credentials: "include",
                });

                const { token } = await resToken.json();

                const res = await fetch("/api/v1/protected", {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: "Bearer " + token,
                    },
                    // credentials: "include",
                });
                console.log(res.ok, res.status);
                const data = await res.json();
                if (res.ok) {
                    document.getElementById("app").textContent = data.email;
                }


                console.log(data);
            } catch (error) {
                console.log(error)
            }
        })
    </script>
</body>

</html>